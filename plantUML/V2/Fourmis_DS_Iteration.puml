@startuml
'https://plantuml.com/sequence-diagram

skinparam style strictuml
skinparam responseMessageBelowArrow true
skinparam roundcorner 20
skinparam ArrowColor #black
hide footbox

participant "AntFacade:ant" as ant #lightgreen
participant "Graphe:g" as graphe #lightcoral

== Mise en place du Graphe ==
' ---------GRAPHE--------------
ant -> ant++ #lightgreen : createGrid(width, height)
    ant --> graphe++ #lightcoral : <<Create>> Graphe(width, height)
return
return

graphe -> graphe++ #lightcoral : creationEmplacementNoeud()
loop i<taille.length
    loop i<taille[i].length
        ' ---------NOEUD--------------
            create "n:Noeud"
            graphe --> "n:Noeud" : <<Create>> Noeud(g, numNoeud)
    end
end
return

ant -> ant++ #lightgreen : putObstacle(x,y)
    ant -> graphe++ #lightcoral : mettreObstacle(x,y)
return
return

ant -> ant++ #lightgreen : putFood(x,y,quantity)
    ant -> graphe++ #lightcoral : mettreNourriture(x,y,quantity)
return
return

' ---------AntFacade Historique--------------
ant -> ant++ #lightgreen : setAntFile(antLogFile)
    create "antHisto:AntFacadeHistorique"
    ant -> "antHisto:AntFacadeHistorique" : <<Create>> AntFacadeHistorique(width,height, grid, antLogFile)
return


== Création des Fourmis ==
' ---------REINE--------------
ant -> ant++ #lightgreen : createColony(x, y)
create "r:Reine"
    ant --> "r:Reine" : <<Create>> Reine(x,y,g)
return

' ---------COLONIE--------------
create "c:Colonie"
"r:Reine" --> "c:Colonie" : <<Create>> Colonie()

ant -> ant++ #lightgreen : setParameters(evapaParam,foodParam,pheroParam)
    ant -> "r:Reine"++ #lightcoral : setParametreColonie(evapaParam,foodParam,pheroParam)
    "r:Reine" -> "c:Colonie"++ #FFBBBB: setFoodParam(foodParam)
    return
    "r:Reine" -> "c:Colonie"++ #FFBBBB: setEvaporationParam(evapaParam)
    return
    "r:Reine" -> "c:Colonie"++ #FFBBBB: setPheromoneParam(pheroParam)
    return
return
return

ant -> ant++ #lightgreen : createSoldiers(amount)
    ant -> "r:Reine"++ #lightblue : giveBirthSoldier(amount)
    loop i<amount
        ' ---------SOLDAT--------------
        create "s:Soldat"
        "r:Reine" --> "s:Soldat" : <<Create>> Soldat(x,y,c,g)
    end
return
return

ant -> ant++ #lightgreen : createWorkers(amount)
    ant -> "r:Reine"++ #lightblue : giveBirthWorker(amount)
    loop i<amount
        ' ---------OUVRIER--------------
        create "o:Ouvrier"
        "r:Reine" --> "o:Ouvrier" : <<Create>> Ouvrier(x,y,c,g)
    end
return
return

== Déclenchement des itérations ==
ant -> ant++ #RoyalBlue : play(time, false)
alt record == true
    ant --> "antHisto:AntFacadeHistorique"++ #DeepSkyBlue : startFile()
    return
end
loop i<duration

    '----------Mettre phéromne -------------
    loop x<height
        loop y<width
            alt nbEvaporation!=0
                alt tabQuantityPheromone[x][y] >= nbEvaporation
                    ant --> graphe++ #FFBBBB : setQuantityPheromone(tabQuantityPheromone)
                    return
                else sinon
                    ant --> graphe++ #FFBBBB : setQuantityPheromone(tabQuantityPheromone)
                    return
                end
            end
        end
    end

    '----------Mettre phéromne -------------

    ' ---------Déplacer Soldat--------------
    alt this.theSoldiers != null
        loop Soldat s : "s:Soldat"
            ant -> "s:Soldat"++ #lightcoral
                "s:Soldat" -> "s:Soldat"++ #FFBBBB: randomDirection()
                    ' ---------ARETES--------------
                    create "ms:FourmisMove"
                    "s:Soldat" --> "ms:FourmisMove"++ #FFBBBB : rechercheAretes(x,y,g)
                        return
                "s:Soldat" --> "ms:FourmisMove"++ #DarkSalmon : randomNoeud()
                return
            return
        end
    end
    return
    ' ---------Déplacer Soldat--------------

    ' ---------Déplacer Ouvrier--------------
    alt this.theWorkers != null
        loop Ouvrier o : "mo:MoveOuvrier"
        alt o.isEtatRetour() && !o.doitRetravailler()
            ant -> "o:Ouvrier"++ #lightcoral
            create "mo:MoveOuvrier"
            "o:Ouvrier"  -> "mo:MoveOuvrier"++ #FFBBBB : cheminRetour(ouvrier)
            return
            return

        else sinon
             ant -> "o:Ouvrier"++ #lightcoral
            "o:Ouvrier" -> "mo:MoveOuvrier"++ #FFBBBB : randomDirection()
             ' ---------ARETES OUVRIER--------------
                 create "ms2:FourmisMove"
                 "mo:MoveOuvrier" --> "ms2:FourmisMove"++ : rechercheAretes(x,y,g)
                    return
                 "mo:MoveOuvrier" --> "mo:MoveOuvrier"++ #DarkSalmon: paramOuvrier(ouvrier)
                     "mo:MoveOuvrier" --> "mo:MoveOuvrier"++ #FFBBBB : rechercheToutVisite(ouvrier)
                         return
                     "mo:MoveOuvrier" --> "mo:MoveOuvrier"++ #FFBBBB : rechercheAucunPheromone(droitDePasssage)
                         alt !rechercheAucunPheromone(droitDePasssage)
                                "mo:MoveOuvrier" --> "mo:MoveOuvrier"++ #FFBBBB: rechercheBestPheromone(xCoord,yCoord)
                                return
                         end
                    return
                return
            return
        end
    end
    return
    ' ---------Déplacer Ouvrier--------------
    end
' ---------Fichier historique des fourmis--------------
== Mise à jour du fichier d'historique des fourmis ==
    alt record == true
        ant --> "antHisto:AntFacadeHistorique"++ #DeepSkyBlue : iteration(this.grid, this.theSoldiers, this.theWorkers)
            loop Ouvrier o : theWorkers
                "antHisto:AntFacadeHistorique" --> "o:Ouvrier"++ #DeepSkyBlue: toString()
                return
                "antHisto:AntFacadeHistorique" --> "mo:MoveOuvrier"++ #DeepSkyBlue: noeudVoisin(ouvrier)
                create "ms3:FourmisMove"
                "mo:MoveOuvrier" --> "ms3:FourmisMove"++ : rechercheAretes(x,y,graphe)
                return
                "mo:MoveOuvrier" --> "ms3:FourmisMove"++ #DeepSkyBlue: noeudVoisin(ouvrier)
                return
                return
            end
            loop Soldat s : theSoldiers
                "antHisto:AntFacadeHistorique" --> "s:Soldat"++ #DeepSkyBlue : toString()
                return
                create "ms4:FourmisMove"
                "antHisto:AntFacadeHistorique" --> "ms4:FourmisMove"++ #DeepSkyBlue: noeudVoisin(soldat, graphe)
                "mo:MoveOuvrier" --> "ms4:FourmisMove"++ : rechercheAretes(x,y,graphe)
                return
                "mo:MoveOuvrier" --> "ms4:FourmisMove"++ #DeepSkyBlue: noeudVoisin(soldat, graphe)
                return
                return
            end
        return
    end
end

alt record == true
    ant --> "antHisto:AntFacadeHistorique"++ #DeepSkyBlue : closeFile()
    return
end
return

@enduml